# UI Unit Test Audit

## Current baseline

- **Shared DataView harness.** `renderResourceDataView` and `flushDataViews` centralise runtime creation, rerendering, and async flushing so every spec consumes the same mocked kernel surface instead of wiring providers per file.【F:packages/ui/src/dataviews/test-support/ResourceDataView.test-support.tsx†L186-L253】
- **Action suites run through a shared scenario helper.** `renderActionScenario`, `buildListResource`, and `buildActionConfig` now live in the DataView test-support harness, keeping runtime wiring, invalidation paths, and policy gating centralised across specs.【F:packages/ui/src/dataviews/test-support/ResourceDataView.test-support.tsx†L110-L253】【F:packages/ui/src/dataviews/**tests**/ResourceDataView.actions.test.tsx†L23-L377】
- **Hooks exercise state matrices.** `useAction` relies on the kernel UI harness and a table-driven matrix to assert success, error, idle, and cancellation behaviour with consistent teardown between cases.【F:packages/ui/src/hooks/**tests**/useAction.test.tsx†L105-L218】
- **Docs point contributors to the helpers.** The README and package AGENT call out the UI harness, DOM observer helper, and DataView test support, emphasising the full helper surface and the expectation to extend the harness with self-tests before reinventing mocks so new suites adopt the shared surface by default.【F:packages/ui/README.md†L145-L155】【F:packages/ui/AGENTS.md†L9-L18】
- **DataView interaction controller exported.** `createDataViewsTestController` now ships with the harness so future suites can mutate selection and view state without bespoke callback plumbing when covering mixed selection or pagination flows.【F:packages/ui/src/dataviews/test-support/ResourceDataView.test-support.tsx†L360-L461】【F:packages/ui/src/dataviews/test-support/**tests**/ResourceDataView.test-support.test.tsx†L76-L116】
- **Mixed selection flows covered through the action harness.** The ResourceDataView action suite now drives selection via `createDataViewsTestController`, mixing manual and item-driven updates to assert action args, metadata, and event payloads stay normalized even when the UI selection contains stale identifiers.【F:packages/ui/src/dataviews/**tests**/ResourceDataView.actions.test.tsx†L1-L229】
- **Standalone fetch specs exercise paginated view changes.** The fetch suite now renders through a shared standalone scenario helper and drives pagination via the DataView controller to verify multi-page refetching, total page computation, and data replacement when navigating between pages.【F:packages/ui/src/dataviews/**tests**/ResourceDataView.fetch.test.tsx†L1-L153】
- **Pagination guards are exercised through standalone fetch scenarios.** Dedicated tests now cover zero and undefined `perPage` values to ensure pagination fallback logic continues to clamp totals to a single page during rerenders.【F:packages/ui/src/dataviews/**tests**/ResourceDataView.fetch.test.tsx†L220-L282】

## Quality signals

- **Fetch/runtime integration lean on the harness.** The fetch and runtime specs render through `renderResourceDataView`, asserting reporter errors, pagination data, standalone runtime support, and DOM metadata without bespoke providers.【F:packages/ui/src/dataviews/**tests**/ResourceDataView.fetch.test.tsx†L1-L153】【F:packages/ui/src/dataviews/**tests**/ResourceDataView.runtime.test.tsx†L1-L160】
- **Policy and unmount behaviour remain covered.** The action suite asserts denied policies, pending resolutions, empty selections, unhandled errors, and unmount scenarios using the shared scenario builder, keeping side-effect expectations co-located with helper usage.【F:packages/ui/src/dataviews/**tests**/ResourceDataView.actions.test.tsx†L170-L377】
- **Kernel harness self-tests keep global state stable.** The UI harness exports registry resets and console guards, and the hook suites consume them to prevent cross-test leakage. The DataView harness self-test now exercises `renderActionScenario` so future suites can rely on its action mocks.【F:packages/ui/tests/ui-harness.test-support.ts†L47-L118】【F:packages/ui/src/hooks/**tests**/useAction.test.tsx†L116-L145】【F:packages/ui/src/dataviews/test-support/**tests**/ResourceDataView.test-support.test.tsx†L5-L68】

## Opportunities

- _No outstanding items._ Continue monitoring pagination edge cases as the DataView surface evolves.【F:packages/ui/src/dataviews/ResourceDataView.tsx†L26-L40】
