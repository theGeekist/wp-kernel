# Phase 8 - UI baseline experience

_Phase reference: [cli-mvp-plan.md](cli-mvp-plan.md)_

Phase 8 turns the IRV1 resource contract into a tangible admin experience. The work lands new DataViews defaults, shared async UX, and an interactivity bridge so authors can describe a resource once and immediately see a polished screen. The CLI wraps up the phase by wiring generators to the richer UI metadata after the runtime stabilises.

## Objectives

- Expand the DataViews config schema so `attachUIBindings()` can auto-register controllers with map/query metadata, saved views, and menu hints straight from `wpk.config`. This keeps `ResourceDataView` inline with the controller/runtime contracts in `@wpkernel/ui`.
- Layer reusable async UX (empty/error/permission states plus notices) on top of the existing controller plumbing so plugins inherit consistent feedback when invoking actions through the kernel pipeline.
- Ship an opt-in interactivity bridge that feeds DataView filters and selections into `defineInteraction`, syncing list state with the WordPress registry and cache hydrators already emitted by the runtime.
- Document the new events/diagnostics so plugin authors can subscribe from PHP, `wp.data`, or interactivity stores without reverse-engineering the runtime internals.
- Close the loop in the CLI only after the UI primitives ship, updating generator output and manifests to enqueue the new runtime assets.

## Release ledger

| Slot   | Task                                  | Status     | Summary                                                                                                                                                         | Key references                                                                                                                                                                                                                                                        |
| ------ | ------------------------------------- | ---------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 0.11.1 | Task 46 - DataViews schema expansion  | ✓ Complete | Extend resource metadata ingestion so `attachUIBindings()` recognises saved layouts, server-driven columns, and menu metadata before a controller instantiates. | [`attachUIBindings`](../src/runtime/attachUIBindings.ts), [`ResourceDataViewConfig`](../src/dataviews/types.ts)                                                                                                                                                       |
| 0.11.2 | Task 47 - Async boundaries & notices  | ✓ Complete | Resource DataViews render shared loading/empty/error/permission boundaries and emit action notices while logging through controller reporters.                  | [`ResourceDataView`](../src/dataviews/ResourceDataView.tsx), [`ResourceDataViewBoundary`](../src/dataviews/resource-data-view/components/boundary/ResourceDataViewBoundary.tsx), [`useDataViewActions`](../src/dataviews/resource-data-view/use-data-view-actions.ts) |
| 0.11.3 | Task 48 - Interactivity bridge        | ✓ Complete | Publish a `createDataViewInteraction()` helper that syncs DataView controllers with `defineInteraction`, forwarding selections, filters, and cache hydration.   | [`attachUIBindings`](../src/runtime/attachUIBindings.ts), [`defineInteraction`](../../core/src/interactivity/defineInteraction.ts)                                                                                                                                    |
| 0.11.4 | Task 49 - Observability & hooks       | ⬜ Planned | Surface structured events, reporter channels, and hook utilities so plugins can subscribe to DataView lifecycle changes without spelunking the runtime.         | [`ResourceDataViewController`](../src/dataviews/resource-controller.ts), [`DataViews events`](../src/runtime/dataviews/events.ts)                                                                                                                                     |
| 0.11.5 | Task 50 - CLI DataView alignment      | ⬜ Planned | Update CLI generators and manifests to emit the richer DataViews config, enqueue UI assets, and snapshot the auto-registration metadata.                        | [`generate.ts`](../../cli/src/commands/generate.ts), [`workspace/filesystem.ts`](../../cli/src/workspace/filesystem.ts)                                                                                                                                               |
| 0.11.6 | Task 51 - CLI interactivity scaffolds | ⬜ Planned | Teach the CLI to scaffold `data-wp-*` bindings, enqueue `wp.interactivity`, and document how generated markup composes with `createDataViewInteraction()`.      | [`generate.ts`](../../cli/src/commands/generate.ts), [`defineInteraction`](../../core/src/interactivity/defineInteraction.ts)                                                                                                                                         |
| 0.12.0 | Task 52 - Phase 8 minor release       | ⬜ Planned | Cut the coordinated 0.12.0 release once Tasks 46-51 land, refresh docs, and sync changelogs across UI, core, and CLI packages.                                  | Phase ledger                                                                                                                                                                                                                                                          |

## Task breakdown

### Patch 0.11.1 - Task 46: DataViews schema expansion (✓ Complete)

Extend `attachUIBindings()` so auto-registration pulls the full schema from `resource.ui.admin.dataviews` instead of requiring manual controllers. That includes validating `mapQuery`, saved layouts, and menu metadata before instantiating `createResourceDataViewController`. Use the extraction helpers already in place to guard against malformed configs and feed the metadata through the registry so generated screens can mirror server defaults.【F:packages/ui/src/runtime/attachUIBindings.ts†L47-L133】【F:packages/ui/src/dataviews/types.ts†L69-L114】 Document the accepted fields in `packages/ui/README.md` and refresh fixtures under `packages/ui/fixtures/dataviews/` once the schema broadens.

### Patch 0.11.2 - Task 47: Async boundaries & notices (✓ Complete)

`ResourceDataView` now wraps DataViews with a `ResourceDataViewBoundary` that renders shared loading, empty, error, and permission-denied states using the controller reporter, list status, and capability runtime.【F:packages/ui/src/dataviews/resource-data-view/components/ResourceDataView.tsx†L33-L74】【F:packages/ui/src/dataviews/resource-data-view/components/boundary/ResourceDataViewBoundary.tsx†L1-L66】 `useListResult()` and the new permission hook surface normalized errors so fetch failures and capability denials reach the boundary while logging context through the reporter.【F:packages/ui/src/dataviews/resource-data-view/use-list-result.ts†L1-L75】【F:packages/ui/src/dataviews/resource-data-view/state/use-permission-state.ts†L1-L94】 `useDataViewActions()` now dispatches success/failure notices via the WordPress registry and records outcomes through the controller reporter, keeping cache invalidation and diagnostics unchanged.【F:packages/ui/src/dataviews/resource-data-view/use-data-view-actions.ts†L1-L258】 Tests cover every boundary and the new notice behaviour.【F:packages/ui/src/dataviews/**tests**/ResourceDataView.boundary.test.tsx†L1-L87】【F:packages/ui/src/dataviews/**tests**/ResourceDataView.actions.test.tsx†L1-L320】

### Patch 0.11.3 - Task 48: Interactivity bridge (✓ Complete)

Publish `createDataViewInteraction()` (or equivalent) alongside `defineInteraction` so DataView controllers can feed filters, selections, and cache invalidations into the Interactivity store. The helper should accept a controller, map view state to interactivity signals, and hydrate the kernel resource cache by calling the dispatcher plumbing already exposed in `defineInteraction`. Ensure the bridge respects auto-registration (`attachUIBindings` should expose controllers) and reuses the pipeline-aware action bindings instead of duplicating invoke logic.【F:packages/ui/src/runtime/attachUIBindings.ts†L80-L183】【F:packages/core/src/interactivity/defineInteraction.ts†L162-L381】 Document installation notes for `@wordpress/interactivity` inside UI docs and update the interactivity guide under `docs/guide/interactivity.md`.

### Patch 0.11.4 - Task 49: Observability & hooks (⬜ Planned)

Surface observability primitives so plugin authors can subscribe to DataView lifecycle events.【F:packages/ui/src/runtime/dataviews/events.ts†L1-L180】 That includes exporting typed hook helpers around the existing `runtime.events.*` emissions (registered, viewChanged, actionTriggered) and exposing reporter channels for capability denials or fetch errors. Provide PHP/JS usage examples in the docs and expand the reporter coverage in `packages/ui/src/dataviews/__tests__/resource-controller.test.ts` to assert emissions for each lifecycle event.【F:packages/ui/src/dataviews/resource-controller.ts†L170-L238】 Add a WordPress hooks bridge (optional) so integrators can listen via `@wordpress/hooks` if needed.

### Patch 0.11.5 - Task 50: CLI DataView alignment (⬜ Planned)

After the UI schema lands, update the CLI pipeline to emit the richer metadata. Extend `wpk generate` so the config writer persists DataView defaults, saved layouts, and menu metadata, and ensure `attachUIBindings` auto-registration continues to work when files regenerate. Refresh workspace manifests (`.wpk/apply/plan.json`) so deletions respect the new metadata files and update tests to snapshot the expanded output.【F:packages/cli/src/commands/generate.ts†L1-L200】【F:packages/cli/src/workspace/filesystem.ts†L1-L200】 Coordinate docs updates in `cli-index.md` to point readers at the new UI capabilities.

### Patch 0.11.6 - Task 51: CLI interactivity scaffolds (⬜ Planned)

Teach the CLI to scaffold front-end bindings that opt into the new interactivity bridge. Generators should output `data-wp-*` attributes, enqueue `wp.interactivity`, and emit fixtures showing how `createDataViewInteraction()` composes with generated actions. Update the CLI pipeline so reporters capture interactivity diagnostics alongside existing apply/generate logs, and document the workflow in the CLI guides.【F:packages/cli/src/commands/generate.ts†L1-L200】【F:packages/core/src/interactivity/defineInteraction.ts†L121-L381】 Refresh fixtures/tests under `packages/cli/tests/integration/` to prove the new bindings deploy correctly.

### Minor 0.12.0 - Task 52: Phase 8 minor release (⬜ Planned)

Run the full release checklist-regenerate API docs, refresh changelogs, sync fixtures, and validate `wpk generate && wpk apply --yes --dry-run` end to end-once Tasks 46-51 ship. Announce the new baseline in `docs/releases/` and confirm the CLI/UI packages share the 0.12.0 tag.
