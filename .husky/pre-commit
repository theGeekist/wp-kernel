#!/bin/sh

# Run lint-staged (formats and lints staged files)
pnpm lint-staged

# TypeScript type check for test files
echo "🔍 Type checking test files..."
pnpm typecheck:tests || {
  echo ""
  echo "❌ TypeScript errors in test files. Please fix before committing."
  echo "💡 Run: pnpm typecheck:tests"
  echo ""
  exit 1
}

# Build documentation to catch syntax errors
echo "📚 Building documentation..."
pnpm docs:build || {
  echo ""
  echo "❌ Documentation build failed. Please fix syntax errors."
  echo "💡 Run: pnpm docs:build"
  echo ""
  exit 1
}

# Check for changeset (only on feature branches)
BRANCH=$(git branch --show-current)
if [[ "$BRANCH" =~ ^(sprint-|feat/|fix/) ]]; then
  if [ -z "$(ls .changeset/*.md 2>/dev/null | grep -v README)" ]; then
    echo ""
    echo "⚠️  No changeset found. Creating one is recommended for tracking changes."
    echo "💡 Run: pnpm changeset"
    echo ""
    # Don't fail - just warn
    # exit 1
  fi
fi
